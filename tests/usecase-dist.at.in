AT_BANNER([Distributed environement use case checks])

AT_SETUP([Local daemon with unlimited lifespan])
AT_CHECK([pkill flom], [ignore], [ignore], [ignore])
AT_CHECK([flom_test_exec3.sh 1 0 0 "-d -1"], [0], [ignore], [ignore])
AT_CHECK([pgrep flom], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([Local daemon not started])
AT_CHECK([pkill flom], [ignore], [ignore], [ignore])
AT_CHECK([flom_test_exec3.sh 1 0 0 "-d 0"], [@_ES_GENERIC_ERROR@], [ignore], [ignore])
AT_CHECK([pgrep flom], [1], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([Local daemon with limited lifespan])
AT_CHECK([pkill flom], [ignore], [ignore], [ignore])
AT_CHECK([flom_test_exec3.sh 1 0 0 "-d 3000" ; sleep 6], [0], [ignore], [ignore])
AT_CHECK([pgrep flom], [1], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([Network daemon with unlimited lifespan])
AT_CHECK([pkill flom], [ignore], [ignore], [ignore])
AT_CHECK([flom_test_exec3.sh 1 0 0 "-d -1 -a $(hostname -I | cut -f 1 -d ' ')"], [0], [ignore], [ignore])
AT_CHECK([pgrep flom], [0], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([Network daemon not started])
AT_CHECK([pkill flom], [ignore], [ignore], [ignore])
AT_CHECK([flom_test_exec3.sh 1 0 0 "-d 0 -a $(hostname -I | cut -f 1 -d ' ')"], [@_ES_GENERIC_ERROR@], [ignore], [ignore])
AT_CHECK([pgrep flom], [1], [ignore], [ignore])
AT_CLEANUP

AT_SETUP([Network daemon with limited lifespan])
AT_CHECK([pkill flom], [ignore], [ignore], [ignore])
AT_CHECK([flom_test_exec3.sh 1 0 0 "-d 3000 -a $(hostname -I | cut -f 1 -d ' ')" ; sleep 6], [0], [ignore], [ignore])
AT_CHECK([pgrep flom], [1], [ignore], [ignore])
AT_CLEANUP

