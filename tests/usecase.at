AT_BANNER([Use cases check])

AT_SETUP([Use case #1])
AT_DATA([expout],
[[ 2 locking for 2 seconds
 1 locking for 1 seconds
 2 ending
 1 ending
]])
AT_CHECK([flom_test_exec1.sh 1 1 1 & flom_test_exec1.sh 2 0 2 ; flom_test_exec1.sh 3 0 0 >/dev/null], [0], [expout], [ignore])
AT_CLEANUP

AT_SETUP([Use case #2])
AT_DATA([expout],
[[ 1 locking for 5 seconds
 3 locking for 3 seconds
 2 locking for 2 seconds
 4 locking for 2 seconds
 3 ending
 1 ending
 4 ending
 2 ending
]])
AT_CHECK([flom_test_exec2.sh 1 1 5 R1 & flom_test_exec2.sh 2 3 2 R1 & flom_test_exec2.sh 3 2 3 R2 & flom_test_exec2.sh 4 4 2 R2 ; flom_test_exec2.sh 5 0 0 R1 >/dev/null ; flom_test_exec2.sh 6 0 0 R2 >/dev/null], [0], [expout], [ignore])
AT_CLEANUP

AT_SETUP([Use case #3])
AT_DATA([expout],
[[ 2 locking for 2 seconds
 1 locking for 1 seconds
Resource already locked, the lock cannot be obtained
 1 ending
 2 ending
]])
AT_CHECK([flom_test_exec3.sh 1 1 1 "-w n" & flom_test_exec1.sh 2 0 2 ; flom_test_exec1.sh 3 0 0 >/dev/null], [0], [expout], [ignore])
AT_CLEANUP

